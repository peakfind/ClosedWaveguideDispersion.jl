<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Inhomogeneous case · ClosedWaveguideDispersion.jl</title><meta name="title" content="Inhomogeneous case · ClosedWaveguideDispersion.jl"/><meta property="og:title" content="Inhomogeneous case · ClosedWaveguideDispersion.jl"/><meta property="twitter:title" content="Inhomogeneous case · ClosedWaveguideDispersion.jl"/><meta name="description" content="Documentation for ClosedWaveguideDispersion.jl."/><meta property="og:description" content="Documentation for ClosedWaveguideDispersion.jl."/><meta property="twitter:description" content="Documentation for ClosedWaveguideDispersion.jl."/><meta property="og:url" content="https://peakfind.github.io/ClosedWaveguideDispersion.jl/zhang_case2/"/><meta property="twitter:url" content="https://peakfind.github.io/ClosedWaveguideDispersion.jl/zhang_case2/"/><link rel="canonical" href="https://peakfind.github.io/ClosedWaveguideDispersion.jl/zhang_case2/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClosedWaveguideDispersion.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../homogeneous/">Homogeneous case with Neumann boundary condition</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../dirichlet/">Homogeneous case with Dirichelt boundary condition</a></li><li class="is-active"><a class="tocitem" href>Inhomogeneous case</a><ul class="internal"><li><a class="tocitem" href="#Problem"><span>Problem</span></a></li><li><a class="tocitem" href="#Code"><span>Code</span></a></li></ul></li><li><a class="tocitem" href="../pa2/">PA-Two</a></li><li><a class="tocitem" href="../pa3/">PA-Three</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Inhomogeneous case</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Inhomogeneous case</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/peakfind/ClosedWaveguideDispersion.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/peakfind/ClosedWaveguideDispersion.jl/blob/main/docs/src/literate_examples/zhang_case2.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Inhomogeneous-case"><a class="docs-heading-anchor" href="#Inhomogeneous-case">Inhomogeneous case</a><a id="Inhomogeneous-case-1"></a><a class="docs-heading-anchor-permalink" href="#Inhomogeneous-case" title="Permalink"></a></h1><h2 id="Problem"><a class="docs-heading-anchor" href="#Problem">Problem</a><a id="Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Problem" title="Permalink"></a></h2><p>This problem is the second example in [<a href="../references/#zhang2021">3</a>] page .</p><ul><li><span>$q(x_{1}, x_{2}) = 9$</span> in a disk with the center <span>$(0, 0.5)$</span> and radius <span>$0.3$</span> and <span>$q(x_{1}, x_{2}) = 1$</span> outside the disk.</li><li>Neumann boundary condition on <span>$\partial \Omega$</span>.</li></ul><h2 id="Code"><a class="docs-heading-anchor" href="#Code">Code</a><a id="Code-1"></a><a class="docs-heading-anchor-permalink" href="#Code" title="Permalink"></a></h2><p>We need the same packages as the homogeneous case</p><pre><code class="language-julia hljs">using Ferrite: Lagrange, RefTriangle
using ClosedWaveguideDispersion</code></pre><p>Here we need to define a new refractive index.</p><pre><code class="language-julia hljs">function n(x)
    r = sqrt(x[1]^2 + (x[2] - 0.5)^2)

    if r &lt;= 0.3
        return 9.0
    else
        return 1.0
    end
end;
p = 1.0;
h = 1.0;
N = 100;</code></pre><p>Then we generate the mesh and set up variables for finite element method.</p><pre><code class="language-julia hljs"># Set up the grid
grid = setup_grid(lc=0.05, period=p, height=h)

# Define the interpolation
ip = Lagrange{RefTriangle, 1}()

# Set up the FE values: CellValues
cv = setup_fevs(ip)

# Set up the DofHandler
dh = setup_dofs(grid, ip)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Ferrite.DofHandler{2, Ferrite.Grid{2, Ferrite.Triangle, Float64}}
  Fields:
    :u, Ferrite.Lagrange{Ferrite.RefTriangle, 1}()
  Dofs per cell: 3
  Total dofs: 513</code></pre><p>For the boundary condition, we only need to use <a href="../api/#ClosedWaveguideDispersion.setup_bdcs-Tuple{Ferrite.DofHandler}"><code>setup_bdcs</code></a> to impose the periodic boundary condition in <span>$x_{1}$</span> direction.</p><pre><code class="language-julia hljs"># Set the boundary conditions
cst = setup_bdcs(dh, period=p)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintHandler:
  BCs:</code></pre><p>We assemble the matrices for the generalized linear eigenvalue problems.</p><pre><code class="language-julia hljs"># Allocate the matrices
A = allocate_matries(dh, cst)
B = allocate_matries(dh, cst)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">513×513 SparseArrays.SparseMatrixCSC{ComplexF64, Int64} with 3509 stored entries:
⎡⠛⣤⣤⢃⣚⣃⢂⢙⢀⡀⠀⠀⢀⠐⠃⠠⡐⠀⠀⠀⠀⡐⠠⠐⠠⢤⡰⠉⠠⠀⠰⠘⠁⠤⢀⠘⢢⠆⢥⡃⎤
⎢⠤⢛⣱⣾⡤⡁⢀⡀⠄⢪⠀⡀⠀⠀⡈⢈⠀⠈⠁⠀⠰⡀⠀⡄⠰⠊⣉⠀⠨⠰⢈⠀⢕⠱⠰⠫⠀⠁⠨⠄⎥
⎢⠾⢸⠄⠫⡻⢎⢜⣎⢵⡈⠀⠀⠈⠀⠀⢉⠐⠀⠡⠈⠂⠦⠀⠀⠀⠖⠊⡉⠁⠈⠨⠀⠄⠀⠠⠄⢢⠀⠾⡪⎥
⎢⣌⢐⠀⠰⡲⢵⣻⣾⢽⡆⠀⠀⠐⢠⢍⡠⠀⠄⡁⡃⠆⠄⡀⠀⠀⠀⢀⠰⠀⠀⠀⠲⠀⠀⠨⢐⡐⠀⡀⣋⎥
⎢⠀⠰⡠⣁⡑⠳⠳⠷⠿⣧⢀⣀⠀⣄⢁⠃⡒⠀⡇⠈⢠⠀⠈⠂⠂⠀⠂⠂⠀⠈⠀⠤⠀⠀⠐⠐⠱⣤⠁⠓⎥
⎢⠀⠀⠀⠠⠀⠀⠀⠀⠀⢰⣿⣿⣟⣽⠐⡴⠣⢐⢨⠀⣜⢃⠐⢄⢑⠩⠀⠀⠀⠈⠆⠀⠀⠀⢂⠄⠀⢒⠀⠀⎥
⎢⢀⠐⠀⠀⠂⠀⠐⣀⠀⢤⣟⣽⣟⣽⡼⣾⠂⠠⠑⠂⢴⠈⡐⡄⢁⢀⢄⣀⠀⠲⡂⠅⠈⠐⡦⠁⠘⠨⠁⠀⎥
⎢⠉⡀⡂⢈⡄⢀⠃⡱⠥⠐⢐⡤⣲⣯⣿⢟⡨⣨⠃⡒⡁⡀⠆⣒⡀⠠⢄⠀⠀⠠⡄⠂⠀⠀⠆⠆⢀⢀⠁⠐⎥
⎢⠐⠈⡀⠀⠐⠀⠀⠄⠘⠈⢉⢂⠈⡀⡂⣪⣟⣽⡞⠬⣊⠥⠘⡐⠃⢀⡀⢀⣤⣦⠂⡤⠀⠀⡀⢂⠀⢀⠂⠂⎥
⎢⠀⠀⠁⠀⡁⠂⠥⠨⡉⠉⠂⠒⠱⠀⢩⠠⡚⡍⠟⣥⡗⣘⣥⣈⠊⠀⡀⠀⠀⡊⠄⠄⠈⠥⠁⠀⠀⠐⢋⢉⎥
⎢⢀⠠⠐⠢⠨⡄⠈⠅⠀⠒⠶⢙⡐⠓⠁⠨⠎⡜⣙⢩⠛⢄⡁⣱⢄⠆⠦⡘⣀⡀⠅⠂⣠⠩⠞⠐⠀⠈⠈⠄⎥
⎢⢀⠂⠀⠤⠀⠀⠀⠈⠢⠀⠐⢄⠐⠬⢨⢡⢒⠠⡁⢻⢅⣨⡵⣯⣿⡎⣄⡥⠄⠀⡀⢤⠁⠈⡅⠍⠐⡶⠐⡋⎥
⎢⠀⣆⡰⠂⢠⠄⠀⠀⠈⠀⡕⡐⠁⢐⠀⡈⠉⢀⠊⠀⠠⠕⡻⠿⡱⣮⣥⠂⡤⠡⡥⢨⠉⠀⠄⡍⠈⠷⢐⠀⎥
⎢⡔⠊⠃⠘⡎⠠⢀⡐⠨⠀⠀⠀⠀⢱⠀⠑⠀⢈⠀⠈⣈⠣⠄⡽⠡⠛⠟⣥⣤⠍⡄⣥⠄⣤⣁⠬⠉⠀⠐⠀⎥
⎢⠀⠂⢂⡂⡁⠀⠀⠀⡀⠀⡀⠀⢠⡀⠀⡀⠠⣿⡠⠠⠀⠸⠀⠁⠄⡋⡄⠟⡿⣯⣷⣯⢢⠐⠂⠲⣣⠥⠀⠀⎥
⎢⣐⠂⠂⠐⠂⠂⢠⡀⠀⡄⠈⠁⠌⠌⠠⠉⠈⡤⠀⠅⠡⠁⠀⣌⡁⣋⠄⣭⡽⣿⢟⣵⣶⠙⣥⡠⣥⡱⠐⠀⎥
⎢⠁⡄⢕⡑⠀⠁⠀⠀⠀⠀⠀⠀⢂⠀⠀⠀⠀⠀⠆⡄⡄⡚⡁⠀⠃⠀⠀⣥⢈⠒⣜⠛⣻⣾⡬⣫⠖⠩⠌⠀⎥
⎢⣀⠐⡴⡂⠀⠆⢂⢂⢐⠀⠈⠔⠌⠋⠨⠅⠠⢈⠁⠀⢚⠁⡅⠍⡄⠥⡁⡜⢨⡀⠁⡻⡦⣫⣟⣽⣫⣒⠐⠀⎥
⎢⠨⠖⠄⠀⠈⠒⠐⠈⠑⣦⢠⢀⡒⡀⠀⢐⠀⢀⢀⠀⡀⠀⢰⡤⢦⡄⠃⠀⠍⡞⢅⡻⡜⡁⢫⢺⢿⣷⡃⠛⎥
⎣⠥⠳⠂⠆⡺⡣⡤⢨⢥⠀⠀⠀⠁⠀⢁⠀⠨⠀⡏⢐⠂⠄⡴⠠⠐⠐⠐⠀⠀⠀⠐⠀⠂⠁⠐⠀⣭⠈⢕⣵⎦</code></pre><p>Then we solve the generalized eigenvalue problems at each <span>$\alpha$</span> in <span>$bz$</span>,</p><pre><code class="language-julia hljs"># Discretize the Brillouin zone
bz = collect(range(-π/p, π/p, N))

# Calculate the dispersion diagram
μ = calc_diagram(cv, dh, cst, A, B, n, bz, nevs=7)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">100×7 Matrix{Float64}:
 1.93232  4.45248  6.3289   13.1637  15.8762  19.9986  22.1028
 1.92551  4.46018  6.32281  13.1704  15.8692  19.9133  22.183
 1.91114  4.47794  6.31192  13.1848  15.8586  19.802   22.2934
 1.88955  4.50541  6.29632  13.2068  15.8445  19.6717  22.4269
 1.86125  4.54209  6.27615  13.2363  15.8268  19.5281  22.5779
 1.82684  4.58736  6.25158  13.2731  15.8056  19.3754  22.7422
 1.78699  4.64056  6.2228   13.3169  15.7808  19.2168  22.9166
 1.7424   4.70096  6.19007  13.3676  15.7525  19.0546  23.0988
 1.69377  4.76789  6.15363  13.4248  15.7206  18.8904  23.2873
 1.64174  4.84067  6.11378  13.4883  15.6853  18.7256  23.4807
 ⋮                                             ⋮       
 1.69377  4.76789  6.15363  13.4248  15.7206  18.8904  23.2873
 1.7424   4.70096  6.19007  13.3676  15.7525  19.0546  23.0988
 1.78699  4.64056  6.2228   13.3169  15.7808  19.2168  22.9166
 1.82684  4.58736  6.25158  13.2731  15.8056  19.3754  22.7422
 1.86125  4.54209  6.27615  13.2363  15.8268  19.5281  22.5779
 1.88955  4.50541  6.29632  13.2068  15.8445  19.6717  22.4269
 1.91114  4.47794  6.31192  13.1848  15.8586  19.802   22.2934
 1.92551  4.46018  6.32281  13.1704  15.8692  19.9133  22.183
 1.93232  4.45248  6.3289   13.1637  15.8762  19.9986  22.1028</code></pre><p>Finally, we can get our dispersion diagram.</p><pre><code class="language-julia hljs"># Plot the dispersion diagram
plot_diagram(bz, μ, period=p)</code></pre><img src="ad95dfa4.png" alt="Example block output"/><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../dirichlet/">« Homogeneous case with Dirichelt boundary condition</a><a class="docs-footer-nextpage" href="../pa2/">PA-Two »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Monday 16 June 2025 14:01">Monday 16 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
